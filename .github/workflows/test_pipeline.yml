name: Test QCD Pipeline
run-name: ${{ github.actor }} is testing snakemake workflow ğŸš€
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  Test-QCD-Pipeline:
    runs-on: ubuntu-latest
    steps:
      - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      
      - name: Checkout repository
        uses: actions/checkout@v3
      - run: echo "ğŸ’¡ The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "ğŸ–¥ï¸ The workflow is now ready to test your code on the runner."
      
      - name: List files in the repository
        run: |
          ls
      
      - name: Get working directory
        run: |
          pwd
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'  
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pytest snakemake  

      - name: Install Singularity
        run: |
          sudo apt-get update
          sudo apt-get install -y singularity
      - name: Snakemake workflow
        uses: snakemake/snakemake-github-action@v1
        with:
          directory: '.'
          snakefile: 'QCD.smk'
          args: '--cores 4 --use-conda --use-singularity --use-envmodules --conda-cleanup-pkgs cache -j 999 --conda-frontend conda --configfile config/config.yaml --latency-wait 1000'
      - run: echo "ğŸ This job's status is ${{ job.status }}."

      #- name: Run Snakemake tests
      #  run: |
      #    pytest tests/test_pipeline.py
